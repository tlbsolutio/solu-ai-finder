<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Consent Mode v2 defaults: deny until user consents -->
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('consent', 'default', {
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'ad_storage': 'denied',
        'analytics_storage': 'denied',
        'functionality_storage': 'denied',
        'personalization_storage': 'denied',
        'security_storage': 'granted'
      });
    </script>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NM7G7NRZ');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>solu-ai-finder</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="solu-ai-finder" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NM7G7NRZ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    
    <!-- ========== Solutio Cookie Banner (FR/EN, Consent Mode v2) ========== -->
    <div id="solu-consent" style="all:initial;font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif">
      <style>
        #solu-consent .wrap{position:fixed;left:0;right:0;bottom:0;z-index:99999;background:#0f172a;color:#fff;box-shadow:0 -10px 30px rgba(0,0,0,.25);padding:16px}
        #solu-consent .inner{max-width:1100px;margin:0 auto;display:flex;gap:16px;align-items:center;flex-wrap:wrap}
        #solu-consent p{margin:0;line-height:1.4}
        #solu-consent a{color:#93c5fd;text-decoration:underline}
        #solu-consent .btn{appearance:none;border:0;border-radius:8px;padding:10px 14px;font-weight:600;cursor:pointer}
        #solu-consent .primary{background:#22c55e;color:#0b2a13}
        #solu-consent .ghost{background:transparent;color:#fff;outline:1px solid #64748b}
        #solu-consent .neutral{background:#334155;color:#fff}
        #solu-consent .sp{flex:1}
        /* Modal */
        #solu-consent .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,.7);z-index:100000}
        #solu-consent .panel{background:#0b1220;color:#fff;border-radius:14px;max-width:720px;width:92%;padding:20px;border:1px solid #1f2937}
        #solu-consent .row{display:flex;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px solid #1e293b}
        #solu-consent .row:last-child{border-bottom:0}
        #solu-consent .tag{font-size:12px;opacity:.75}
        #solu-consent label{display:flex;gap:10px;align-items:flex-start;cursor:pointer}
        #solu-consent input[type=checkbox]{transform:scale(1.2)}
      </style>

      <!-- Banner -->
      <div class="wrap" role="dialog" aria-live="polite" aria-label="Cookie consent banner">
        <div class="inner">
          <p id="solu-text"></p>
          <div class="sp"></div>
          <button class="btn ghost" id="solu-reject"></button>
          <button class="btn neutral" id="solu-customize"></button>
          <button class="btn primary" id="solu-accept"></button>
        </div>
      </div>

      <!-- Modal -->
      <div class="modal" id="solu-modal" aria-modal="true" role="dialog" aria-label="Cookie preferences">
        <div class="panel">
          <h3 id="solu-modal-title" style="margin:0 0 6px 0"></h3>
          <p class="tag" id="solu-modal-tag"></p>

          <div class="row">
            <div><strong id="lab-essential"></strong><div class="tag" id="desc-essential"></div></div>
            <div><input type="checkbox" checked disabled></div>
          </div>

          <div class="row">
            <label for="chk-analytics">
              <div><strong id="lab-analytics"></strong><div class="tag" id="desc-analytics"></div></div>
            </label>
            <div><input id="chk-analytics" type="checkbox"></div>
          </div>

          <div class="row">
            <label for="chk-marketing">
              <div><strong id="lab-marketing"></strong><div class="tag" id="desc-marketing"></div></div>
            </label>
            <div><input id="chk-marketing" type="checkbox"></div>
          </div>

          <div class="row">
            <label for="chk-affiliate">
              <div><strong id="lab-affiliate"></strong><div class="tag" id="desc-affiliate"></div></div>
            </label>
            <div><input id="chk-affiliate" type="checkbox"></div>
          </div>

          <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:16px">
            <button class="btn ghost" id="solu-cancel"></button>
            <button class="btn primary" id="solu-save"></button>
          </div>
        </div>
      </div>

      <script>
        // ------- i18n (auto FR/EN) -------
        const isFR = (navigator.language||'en').toLowerCase().startsWith('fr');
        const T = isFR ? {
          banner: `Nous utilisons des cookies pour faire fonctionner le site, mesurer l'audience (GA4) et suivre les liens d'affiliation (p.ex. CJ). Vous pouvez accepter, refuser ou personnaliser. Voir notre <a href="/privacy" target="_blank" rel="noopener">Politique de confidentialité</a>.`,
          accept:'Accepter',
          reject:'Refuser',
          customize:'Personnaliser',
          modalTitle:'Préférences de cookies',
          modalTag:'Choisissez ce que vous autorisez. Les cookies essentiels sont toujours actifs.',
          essential:'Essentiels',
          essentialDesc:'Fonctionnement de base et sécurité du site',
          analytics:'Analytics (GA4)',
          analyticsDesc:'Mesure d'audience. Aucune donnée personnelle sans consentement.',
          marketing:'Marketing / Publicité',
          marketingDesc:'Mesure et personnalisation publicitaires.',
          affiliate:'Suivi d'affiliation (CJ, etc.)',
          affiliateDesc:'Mesure les ventes issues de nos liens pour recevoir une commission.',
          cancel:'Annuler',
          save:'Enregistrer'
        } : {
          banner: `We use cookies to run the site, measure usage (GA4), and track affiliate links (e.g., CJ). You can accept, reject, or customize. See our <a href="/privacy-en" target="_blank" rel="noopener">Privacy Policy</a>.`,
          accept:'Accept',
          reject:'Reject',
          customize:'Customize',
          modalTitle:'Cookie preferences',
          modalTag:'Choose what to allow. Essential cookies are always on.',
          essential:'Essential',
          essentialDesc:'Required for basic site function & security',
          analytics:'Analytics (GA4)',
          analyticsDesc:'Helps us understand usage. No personal data until consent.',
          marketing:'Marketing / Ads',
          marketingDesc:'Advertising measurement & personalization.',
          affiliate:'Affiliate tracking (CJ, etc.)',
          affiliateDesc:'Tracks referrals so we can earn commissions when you buy.',
          cancel:'Cancel',
          save:'Save preferences'
        };
        const $ = s => document.querySelector(s);
        $('#solu-text').innerHTML = T.banner;
        $('#solu-accept').textContent = T.accept;
        $('#solu-reject').textContent = T.reject;
        $('#solu-customize').textContent = T.customize;
        $('#solu-modal-title').textContent = T.modalTitle;
        $('#solu-modal-tag').textContent = T.modalTag;
        $('#lab-essential').textContent = T.essential;
        $('#desc-essential').textContent = T.essentialDesc;
        $('#lab-analytics').textContent = T.analytics;
        $('#desc-analytics').textContent = T.analyticsDesc;
        $('#lab-marketing').textContent = T.marketing;
        $('#desc-marketing').textContent = T.marketingDesc;
        $('#lab-affiliate').textContent = T.affiliate;
        $('#desc-affiliate').textContent = T.affiliateDesc;
        $('#solu-cancel').textContent = T.cancel;
        $('#solu-save').textContent = T.save;

        // ------- Consent persistence -------
        const KEY = 'solutio_consent_v2';
        const defaults = {analytics:false, marketing:false, affiliate:false};
        function readC(){ try { return JSON.parse(localStorage.getItem(KEY))||null; } catch(e){ return null; } }
        function writeC(v){ localStorage.setItem(KEY, JSON.stringify(v)); }

        // Ensure Consent Mode defaults function exists
        if(!window.dataLayer){ window.dataLayer=[]; }
        function gtag(){ dataLayer.push(arguments); }
        function applyConsent(s){
          gtag('consent','update',{
            'analytics_storage': s.analytics?'granted':'denied',
            'ad_storage':       s.affiliate?'granted':'denied',
            'ad_user_data':     s.marketing?'granted':'denied',
            'ad_personalization': s.marketing?'granted':'denied',
            'personalization_storage': s.marketing?'granted':'denied'
          });
        }

        // ------- UI controls -------
        const banner = $('#solu-consent .wrap');
        const modal  = $('#solu-modal');
        function hideBanner(){ banner.style.display='none'; }
        function showBanner(){ banner.style.display='block'; }
        function openModal(){ modal.style.display='flex'; }
        function closeModal(){ modal.style.display='none'; }

        $('#solu-accept').addEventListener('click', ()=>{
          const all = {analytics:true, marketing:true, affiliate:true};
          writeC(all); applyConsent(all); hideBanner();
        });
        $('#solu-reject').addEventListener('click', ()=>{
          const none = {analytics:false, marketing:false, affiliate:false};
          writeC(none); applyConsent(none); hideBanner();
        });
        $('#solu-customize').addEventListener('click', ()=>{
          const s = readC() || defaults;
          $('#chk-analytics').checked = !!s.analytics;
          $('#chk-marketing').checked = !!s.marketing;
          $('#chk-affiliate').checked = !!s.affiliate;
          openModal();
        });
        $('#solu-cancel').addEventListener('click', closeModal);
        $('#solu-save').addEventListener('click', ()=>{
          const s = {
            analytics: $('#chk-analytics').checked,
            marketing: $('#chk-marketing').checked,
            affiliate: $('#chk-affiliate').checked
          };
          writeC(s); applyConsent(s); closeModal(); hideBanner();
        });

        (function init(){
          const s = readC();
          if(s){ applyConsent(s); hideBanner(); } else { showBanner(); }
          window.openCookieSettings = function(){
            const cur = readC() || defaults;
            $('#chk-analytics').checked = !!cur.analytics;
            $('#chk-marketing').checked = !!cur.marketing;
            $('#chk-affiliate').checked = !!cur.affiliate;
            openModal();
          };
        })();
      </script>
    </div>
    <!-- ========== End Solutio Cookie Banner ========== -->
  </body>
</html>
